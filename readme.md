# Repeater

In Russian because non-Russian speaking doesn't use VK.

Repeater - бот для мессенджера Discord, позволяющий отслеживать и пересылать новые публикации в сообществах VK. Отслеживание настраиваемо, но пока что существует только один параметр для настройки - пингуемая роль при отправке нового поста.

Бот почти полностью асинхронен, за исключением БД (sqlite). Для работы с api Discord используется фреймворк Nextcord, для работы с api VK реализованы свои инструменты.

Основная идея бота Repeater - реализация вебхуков для связи VK и Discord. Discord имеет встроенные вебхуки, но они работают с ограниченным количеством сервисов (например, GitHub). VK api также предоставляет вебхуки для сообществ, но они ограниченны и использовать их могут только владельцы сообществ и люди, которые могут с ними связаться для получения нужного токена. Поэтому, бот Repeater реализует технологию short-polling, из-за чего, конечно, тратятся гораздо большие ресурсы сети и совершается гораздо большее количество запросов, но при этом любой пользователь может сделать свой собственный "вебхук" для VK в Discord.

## Некоторая информация об использовании бота (она также доступна по слеш-команде /help)

Текущие параметры команд:

- pinged_role_id - ID роли, которую нужно пинговать при отправке поста по какой-либо подписке


Список команд:

- /ping - простое получение данных о пинге.


- /add <url VK сообщества> <параметр=аргумент>.


- /help - информация о боте и том, как им пользоваться.

- /set <url VK сообщества> <параметр=аргумент> - |ТРЕБУЮТСЯ ПРАВА АДМИНИСТРАТОРА| настройка параметров подписки на какой-либо паблик.


- /delete <url VK сообщества> - |ТРЕБУЮТСЯ ПРАВА АДМИНИСТРАТОРА| удаляет переданное сообщество из подписок канала.


- /subscriptions - список всех подписок канала, из которого вызывалась команда.

В командах /set и /delete следует передавать тот url, который показывается при вызове команды /subscriptions, ибо другие url не хранятся по причине того, что они могут поменяться. В /add можно передавать какой угодно url.


## Самый простой способ запустить бота:
- скачать архивом код с GitHub, распаковать
- установить язык программирования Python версии 3.8 и выше
- создать виртуальную среду (опционально, но рекомендуемо)
- установить нужные библиотеки в виртуальную среду или в глобальный интерпретатор следующим образом:
```
pip install -r /<путь к этому файлу>/requirements.txt
```
- получить токен для работы с VK api и токен для Discord бота, вставить их в соответствующие поля файла ```config.py```. Как - не расскажу, ибо сам уже не помню, прошу прощения.
- Запустить файл ```main.py```
- Пригласить бота в какое-то место в Discord
- Протестировать и радоваться жизни

В файле ```config.py``` можно настроить периодичность обхода сообществ VK для проверки наличия нового поста, это поле timeout (время указывается в секундах).
